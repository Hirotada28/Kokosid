# 実装計画: Kokosid（ACTベース自己管理パートナーアプリ）

## 概要

Kokosidの実装は、心理学的安全性を最優先としたローカルファースト設計から始まり、段階的にAI機能と高度な分析機能を追加していきます。各ステップは前のステップの成果を基盤とし、最終的に統合された完全なシステムを構築します。

## タスク

- [x] 1. プロジェクト基盤とセキュリティ層の構築
  - Flutterプロジェクトの初期化とマルチプラットフォーム設定
  - エンドツーエンド暗号化システムの実装
  - Isar DatabaseとFlutter Secure Storageの統合
  - _要件: 5.1, 5.2, 5.3_

- [ ]\* 1.1 暗号化システムのプロパティテスト作成
  - **プロパティ10: エンドツーエンド暗号化の完全性**
  - **検証: 要件 5.2, 5.3**

- [x] 2. データモデルとローカルストレージの実装
  - [x] 2.1 コアデータモデル（User、Task、JournalEntry、SelfEsteemScore）の実装
    - Isarコレクションクラスの定義
    - リレーションシップとインデックスの設定
    - _要件: 6.1, 1.1_
  - [ ]\* 2.2 データモデルのプロパティテスト作成
    - **プロパティ13: 自己肯定感スコア計算の一貫性**
    - **検証: 要件 6.1, 6.2**
  - [x] 2.3 暗号化データ永続化レイヤーの実装
    - 暗号化/復号化ヘルパークラス
    - データベース操作の暗号化統合
    - _要件: 5.2, 5.5_

- [x] 3. 基本UI構造と3タブ設計の実装
  - [x] 3.1 メインナビゲーション（今日・対話・軌跡タブ）の構築
    - BottomNavigationBarの実装
    - 各タブの基本画面構造
    - _要件: 8.1, 8.2, 8.3, 8.4_
  - [x] 3.2 「今日」タブの実装
    - 気分選択UI
    - 次のタスク提案表示
    - 小さな達成リスト
    - _要件: 8.2_
  - [ ]\* 3.3 UIコンポーネントのプロパティテスト作成
    - **プロパティ17: パフォーマンス品質の維持**
    - **検証: 要件 8.5**

- [x] 4. チェックポイント - 基本機能の動作確認
  - 全てのテストが通ることを確認し、ユーザーに質問があれば対応する。

- [x] 5. マイクロ・チャンキング機能の実装
  - [x] 5.1 タスク分解エンジンの実装
    - AIプロンプトテンプレートの作成
    - 分解ロジックの実装（5分制限、7ステップ制限）
    - _要件: 1.1, 1.2, 1.3, 1.4, 1.5_
  - [x] 5.2 マイクロ・チャンキングのプロパティテスト作成
    - **プロパティ1: マイクロ・チャンキング制約の遵守**
    - **検証: 要件 1.1, 1.2, 1.3, 1.4, 1.5**
  - [x] 5.3 タスク管理UIの実装
    - タスク追加・編集・削除機能
    - マイクロタスク表示とチェックオフ機能
    - _要件: 1.1, 5.5_

- [x] 6. ACTベースAI対話システムの実装
  - [x] 6.1 ACT対話エンジンの実装
    - 6つのコアプロセス判定ロジック
    - 感情状態に応じた応答生成
    - _要件: 2.1, 2.2, 2.3, 2.5_
  - [x] 6.2 ACT対話システムのプロパティテスト作成
    - **プロパティ2: ACT対話プロセスの適切な選択**
    - **検証: 要件 2.1, 2.2, 2.3, 2.5**
  - [x] 6.3 対話履歴管理と個別化応答の実装
    - 対話履歴の暗号化保存
    - 個別化応答生成ロジック
    - _要件: 2.4_
  - [x] 6.4 個別化応答のプロパティテスト作成
    - **プロパティ3: 個別化された対話応答の生成**
    - **検証: 要件 2.4**

- [x] 7. 音声入力と3層感情分析の実装
  - [x] 7.1 音声録音・再生機能の実装
    - 音声録音UI
    - ローカルファイル管理
    - _要件: 3.1_
  - [x] 7.2 音響特徴分析エンジンの実装
    - ピッチ、発話速度、声量の抽出
    - 音響特徴からの感情推定
    - _要件: 3.1_
  - [x] 7.3 音響分析のプロパティテスト作成
    - **プロパティ4: 3層感情分析の統合処理**
    - **検証: 要件 3.1, 3.3, 3.5**
  - [x] 7.4 Whisper API統合とテキスト感情分析
    - 音声テキスト変換（95%精度目標）
    - BERT感情分類モデル統合
    - _要件: 3.2, 3.3_
  - [ ]\* 7.5 音声認識精度のプロパティテスト作成
    - **プロパティ5: 音声認識精度の保証**
    - **検証: 要件 3.2**
  - [x] 7.6 感情トレンド分析の実装
    - 過去7日間の感情履歴分析
    - 改善・悪化・安定の傾向検出
    - _要件: 3.4_
  - [x] 7.7 感情分類のプロパティテスト作成
    - **プロパティ6: 感情分類の完全性**
    - **検証: 要件 3.3, 3.4**

- [ ] 8. チェックポイント - AI機能の統合確認
  - 全てのテストが通ることを確認し、ユーザーに質問があれば対応する。

- [ ] 9. プレシジョン・ナッジング機能の実装
  - [ ] 9.1 生産的時間帯予測モデルの実装
    - 過去30日間のタスク完了データ分析
    - 時間帯別完了率の学習
    - _要件: 4.1_
  - [ ]\* 9.2 時間帯学習のプロパティテスト作成
    - **プロパティ8: 生産的時間帯学習の実行**
    - **検証: 要件 4.1**
  - [ ] 9.3 心理状態適応型通知システムの実装
    - 心理状態に応じたトーン調整
    - 不安/疲労時の優しい通知、ポジティブ時の励まし通知
    - _要件: 4.2, 4.3, 4.4_
  - [ ]\* 9.4 適応型通知のプロパティテスト作成
    - **プロパティ7: 心理状態適応型通知システム**
    - **検証: 要件 4.2, 4.3, 4.4**
  - [ ] 9.5 連続達成演出システムの実装
    - 連続完了3個以上の検出
    - 特別な達成感演出通知
    - _要件: 4.5_
  - [ ]\* 9.6 達成演出のプロパティテスト作成
    - **プロパティ9: 達成感演出の連続完了対応**
    - **検証: 要件 4.5**

- [ ] 10. 自己肯定感スコアと可視化の実装
  - [ ] 10.1 自己肯定感スコア計算エンジンの実装
    - 4要素（完了率、感情比率、継続日数、対話頻度）の重み付き計算
    - スコア履歴の管理
    - _要件: 6.1, 6.2_
  - [ ] 10.2 「軌跡」タブの可視化実装
    - 自己肯定感推移グラフ
    - 月間達成統計
    - 算出根拠の表示
    - _要件: 6.3, 8.4_
  - [ ]\* 10.3 進歩認識のプロパティテスト作成
    - **プロパティ14: 進歩認識と可視化の提供**
    - **検証: 要件 6.3, 6.4**
  - [ ] 10.4 進歩承認システムの実装
    - 0.05ポイント以上向上時の承認メッセージ
    - 長期成長トレンド分析
    - _要件: 6.4, 6.5_

- [ ] 11. お祝い演出とモチベーション機能の実装
  - [ ] 11.1 タスク完了時アニメーションシステムの実装
    - Lottieアニメーション統合
    - タスク規模別アニメーション（キラキラ星、紙吹雪、ストリーク炎）
    - _要件: 7.1, 7.2, 7.3_
  - [ ]\* 11.2 アニメーション表示のプロパティテスト作成
    - **プロパティ15: タスク完了時のアニメーション表示**
    - **検証: 要件 7.1, 7.2, 7.3, 7.4**
  - [ ] 11.3 パーソナライズド賞賛システムの実装
    - 個別化された賞賛メッセージ生成
    - 過去の成功体験記録と活用
    - _要件: 7.4, 7.5_
  - [ ]\* 11.4 成功体験活用のプロパティテスト作成
    - **プロパティ16: 成功体験の記録と活用**
    - **検証: 要件 7.5**

- [ ] 12. Supabase同期とオフライン機能の実装
  - [ ] 12.1 Supabase統合とCRDT同期の実装
    - PostgreSQLスキーマ設定
    - エンドツーエンド暗号化データの同期
    - _要件: 5.2, 5.3_
  - [ ] 12.2 オフライン機能の実装
    - ネットワーク切断時の基本機能動作
    - 同期待ちデータの管理
    - _要件: 5.5_
  - [ ]\* 12.3 オフライン機能のプロパティテスト作成
    - **プロパティ12: オフライン機能の完全動作**
    - **検証: 要件 5.5**
  - [ ] 12.4 データ削除機能の実装
    - 完全なアカウント削除（30日以内）
    - GDPR準拠のデータエクスポート
    - _要件: 5.4_
  - [ ]\* 12.5 データ削除のプロパティテスト作成
    - **プロパティ11: データ削除の完全実行**
    - **検証: 要件 5.4**

- [ ] 13. エラーハンドリングと回復機能の実装
  - [ ] 13.1 AI API障害時のフォールバック機能
    - ローカルAIへの自動切り替え
    - 事前定義済み応答の活用
    - _設計書のエラーハンドリング仕様_
  - [ ] 13.2 暗号化キー紛失時の回復機能
    - キー紛失検出と警告
    - 新しいセッション初期化
    - _設計書のエラーハンドリング仕様_
  - [ ] 13.3 同期競合解決システムの実装
    - CRDT戦略による自動競合解決
    - データタイプ別解決戦略
    - _設計書のエラーハンドリング仕様_

- [ ] 14. 最終統合とテスト
  - [ ] 14.1 全機能の統合テスト
    - エンドツーエンドフローの検証
    - パフォーマンステスト（60fps維持）
    - _全要件の統合検証_
  - [ ] 14.2 セキュリティ監査と最適化
    - 暗号化実装の検証
    - プライバシー保護機能の確認
    - _要件: 5.1, 5.2, 5.3_
  - [ ] 14.3 ユーザビリティテストの準備
    - オンボーディングフローの最適化
    - アクセシビリティ対応
    - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ] 15. 最終チェックポイント - 全システム動作確認
  - 全てのテストが通ることを確認し、ユーザーに質問があれば対応する。

## 注記

- `*`マークの付いたタスクはオプションであり、MVP開発を優先する場合はスキップ可能です
- 各タスクは前のタスクの成果を基盤とし、段階的に機能を構築します
- チェックポイントタスクでは、進捗確認と問題の早期発見を行います
- プロパティテストは各機能の正確性を保証し、回帰バグを防止します
- 全てのデータ処理において、プライバシー保護が最優先されます
