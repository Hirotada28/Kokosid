# 正確性プロパティ

## 概要

プロパティとは、システムの全ての有効な実行において真であるべき特性や動作です。プロパティは人間が読める仕様と機械で検証可能な正確性保証の橋渡しとして機能します。

## プロパティ一覧

### マイクロ・チャンキング機能

#### プロパティ1: マイクロ・チャンキング制約の遵守

> *全ての*タスクに対して、分解されたステップは以下の制約を満たす：
>
> - 各ステップの推定時間が5分以内
> - 具体的動詞で開始
> - 成功条件が明確
> - 最初のステップが実行系
> - 総ステップ数が7個以下

**検証対象:** 要件 1.1, 1.2, 1.3, 1.4, 1.5

```dart
// テスト例
testProperty('全てのタスクが適切に分解される', () {
  forAll(taskGenerator, (task) async {
    final steps = await microChunkingEngine.decomposeTask(task);

    expect(steps.length, lessThanOrEqualTo(7));
    expect(steps.every((s) => s.estimatedMinutes <= 5), isTrue);
    expect(steps.every((s) => s.action.startsWithActionVerb()), isTrue);
    expect(steps.every((s) => s.successCriteria.isNotEmpty), isTrue);
    expect(steps.first.action.isExecutionAction(), isTrue);
  });
});
```

---

### ACT対話コーチング

#### プロパティ2: ACT対話プロセスの適切な選択

> *全ての*ユーザー入力に対して、システムは感情状態と文脈に基づいてACTの6つのコアプロセスのうち最適なものを選択し、対応する技法を適用する

**ACTの6つのコアプロセス:**

1. 受容 (Acceptance)
2. 認知的脱フュージョン (Cognitive Defusion)
3. 価値の明確化 (Values)
4. コミットされた行動 (Committed Action)
5. マインドフルネス (Present Moment)
6. 観察する自己 (Self as Context)

**検証対象:** 要件 2.1, 2.2, 2.3, 2.5

#### プロパティ3: 個別化された対話応答の生成

> *全ての*対話において、システムは過去の対話履歴を参照し、同一入力でも履歴によって異なる個別化された応答を生成する

**検証対象:** 要件 2.4

---

### 感情分析

#### プロパティ4: 3層感情分析の統合処理

> *全ての*音声入力に対して、システムは以下の3層を実行し、重み付き統合により総合的な感情スコアを算出する：
>
> 1. 音響特徴分析（オンデバイス）
> 2. テキスト分析（言語解析）
> 3. コンテキスト分析（履歴トレンド）

**検証対象:** 要件 3.1, 3.3, 3.5

#### プロパティ5: 音声認識精度の保証

> *全ての*日本語音声入力に対して、システムは95%以上の精度でテキスト変換を実行する

**検証対象:** 要件 3.2

#### プロパティ6: 感情分類の完全性

> *全ての*テキスト入力に対して、システムは6つの感情カテゴリのいずれか1つに分類し、トレンド分析を実行する

**感情カテゴリ:** 喜び、悲しみ、怒り、不安、疲労、中立

**トレンド:** 改善、悪化、安定

**検証対象:** 要件 3.3, 3.4

---

### プレシジョン・ナッジング

#### プロパティ7: 心理状態適応型通知システム

> *全ての*通知送信において、システムは現在の心理状態に応じて適切なトーンを選択する

| 状態       | トーン | 送信タイミング |
| ---------- | ------ | -------------- |
| 不安/疲労  | 優しい | 30分後再送     |
| ポジティブ | 励まし | 即時送信       |
| その他     | 中立   | 通常送信       |

**検証対象:** 要件 4.2, 4.3, 4.4

#### プロパティ8: 生産的時間帯学習の実行

> *全ての*十分なデータを持つユーザーに対して、システムは過去30日間のタスク完了データから生産的時間帯パターンを学習し、最適な通知タイミングを予測する

**検証対象:** 要件 4.1

#### プロパティ9: 達成感演出の連続完了対応

> *全ての*連続完了3個以上の状況において、システムは特別な達成感を演出する通知を送信する

**検証対象:** 要件 4.5

---

### セキュリティ・プライバシー

#### プロパティ10: エンドツーエンド暗号化の完全性

> *全ての*ユーザーデータに対して：
>
> - システムはローカルでAES-256暗号化を実行してからサーバー送信
> - サーバー側では暗号化データのみを保持
> - 復号化キーはサーバーに一切保持しない

**検証対象:** 要件 5.2, 5.3

#### プロパティ11: データ削除の完全実行

> *全ての*データ削除要求に対して、システムは30日以内にローカル・サーバー両方から全データを完全削除する

**検証対象:** 要件 5.4

#### プロパティ12: オフライン機能の完全動作

> *全ての*ネットワーク切断状態において、システムは基本機能を完全に動作させる

**オフライン対応機能:**

- タスク管理（CRUD）
- 日記記録
- スコア表示（キャッシュ）

**検証対象:** 要件 5.5

---

### 自己肯定感スコア

#### プロパティ13: 自己肯定感スコア計算の一貫性

> *全ての*スコア算出において、システムは過去7日間のデータに基づき、以下の重み係数を適用して0.0-1.0の範囲でスコアを算出する

| 要素               | 重み |
| ------------------ | ---- |
| タスク完了率       | 30%  |
| ポジティブ感情比率 | 40%  |
| 継続日数           | 20%  |
| AI対話頻度         | 10%  |

**検証対象:** 要件 6.1, 6.2

```dart
testProperty('自己肯定感スコアが正しく計算される', () {
  forAll(userDataGenerator, (userData) async {
    final score = await calculator.calculateScore(userData.userUuid);

    expect(score, inInclusiveRange(0.0, 1.0));

    final basis = await calculator.getCalculationBasis(userData.userUuid);
    final expectedScore =
      (basis.completionRate * 0.3) +
      (basis.positiveRatio * 0.4) +
      (basis.streakScore * 0.2) +
      (basis.engagementScore * 0.1);

    expect(score, closeTo(expectedScore, 0.001));
  });
});
```

#### プロパティ14: 進歩認識と可視化の提供

> *全ての*スコア確認時において：
>
> - システムは推移グラフと算出根拠を表示
> - 0.05ポイント以上の向上で承認メッセージを表示

**検証対象:** 要件 6.3, 6.4

---

### ポジティブ・フィードバック

#### プロパティ15: タスク完了時のアニメーション表示

> *全ての*タスク完了において、システムはタスク規模に応じて適切なアニメーションを表示する

| タスク規模 | アニメーション | 時間   |
| ---------- | -------------- | ------ |
| 5分以下    | キラキラ星     | 1秒    |
| 15分以下   | 紙吹雪         | 1.5秒  |
| 連続達成   | ストリーク炎   | ループ |

**検証対象:** 要件 7.1, 7.2, 7.3, 7.4

#### プロパティ16: 成功体験の記録と活用

> *全ての*困難な時期において、システムは過去の成功体験を記録から検索し、適切なタイミングで思い出させる機能を提供する

**検証対象:** 要件 7.5

---

### パフォーマンス

#### プロパティ17: パフォーマンス品質の維持

> *全ての*画面において、システムは60fps以上のスムーズなアニメーションを維持する

**検証対象:** 要件 8.5

---

## プロパティと要件のマッピング

| プロパティ | 関連要件      | カテゴリ               |
| ---------- | ------------- | ---------------------- |
| P1         | 1.1-1.5       | マイクロ・チャンキング |
| P2         | 2.1-2.3, 2.5  | ACT対話                |
| P3         | 2.4           | ACT対話                |
| P4         | 3.1, 3.3, 3.5 | 感情分析               |
| P5         | 3.2           | 感情分析               |
| P6         | 3.3, 3.4      | 感情分析               |
| P7         | 4.2-4.4       | ナッジング             |
| P8         | 4.1           | ナッジング             |
| P9         | 4.5           | ナッジング             |
| P10        | 5.2, 5.3      | セキュリティ           |
| P11        | 5.4           | セキュリティ           |
| P12        | 5.5           | オフライン             |
| P13        | 6.1, 6.2      | スコア                 |
| P14        | 6.3, 6.4      | スコア                 |
| P15        | 7.1-7.4       | フィードバック         |
| P16        | 7.5           | フィードバック         |
| P17        | 8.5           | パフォーマンス         |

## 関連ドキュメント

- [テスト戦略](test-strategy.md)
- [要件定義](requirements.md)
- [設計書](design.md)
